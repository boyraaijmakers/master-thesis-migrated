package deloitte.storm.spouts;

import backtype.storm.spout.SpoutOutputCollector;
import backtype.storm.task.TopologyContext;
import backtype.storm.topology.OutputFieldsDeclarer;
import backtype.storm.topology.base.BaseRichSpout;
import backtype.storm.tuple.Fields;
import backtype.storm.tuple.Values;
import backtype.storm.utils.Utils;

import java.util.Map;
import java.util.Random;

public class RandomSentenceSpout extends BaseRichSpout {
    SpoutOutputCollector _collector;
    Random _rand;


    @Override
    public void open(Map conf, TopologyContext context, SpoutOutputCollector collector) {
        _collector = collector;
        _rand = new Random();
    }

    @Override
    public void nextTuple() {
        Utils.sleep(100);
        String[] sentences = new String[]{
                "With-profits is bigbusiness. More than half by value of current UK life policies, and about a third of pension policies, are with-profits.  And with-profits is still selling well, accounting for one-third of policies sold in 1999, the last year for which figures are available.  But questions are increasingly being raised about the viability of with-profits as an investment option, made more pressing by the Equitable Life saga.  Few people understand how with-profits policies work, and as a result may fail to take full advantage of the benefits they purport to offer. The main benefit is the smoothing of investment returns but critics suggest this benefit is sometimes illusory. It has certainly proved so in Equitable's case, where policy values have been cut by 16 per cent for pensions and 14 per cent for life policies.  That is an extreme example, but other insurance companies are taking similar, if less drastic action, by applying penalties known as market value adjusters (MVAs) to policies surrendered or transferred.  John Chapman, an independent analyst who has just published a report on with-profits policies, says  'When the market falls and the heat comes on, the smoothing isn't there.'  Smoothing works by paying some investors with maturing policies more than their money has earned, usually in periods when the stock market has fallen, and others less, usually when markets are high.  According to a survey by actuaries Tillinghast-Towers Perrin, the usual range is between 95 per cent and 105 per cent, but a few companies have paid out more than 130 per cent of fair 'asset share' as the true value of with-profit policies is known. Such overpayments mean that money has to be clawed back from other policy holders. You will usually get less than the true value if you surrender or transfer your policy. The typical proportion is 90 per cent to 95 per cent, but can be less than 70 per cent.  Chapman says  'Smoothing (values) up is being negated by market value adjusters, but smoothing down still operates, which makes for a lopsided situation, you might even say unfair.'  Chapman's report, titled provocatively 'Should with-profits be closed down?' suggests the way forward for with-profits is to jettison much of its current baggage or, as the title suggests, to close with-profits funds to new business.  He is not alone in calling for reform. The Consumers' Association published a report in February that raised the issues of governance and accountability, as well as transparency.  The Association of British Insurers has launched a voluntary accreditation scheme that includes requirements for greater disclosure.  The Institute of Actuaries has issued proposals for greater transparency and the Financial Services Authority is undertaking a review of with-profits that will cover issues including orphan assets, transparency, disclosure, and governance.  Most of these bodies are agreed that, while reform is essential, the basic with-profits concept of smoothed investment returns is a valuable one, and no one wants to 'chuck the baby out with the bath water'.  But Chapman says investors in with-profits are foregoing better long-term returns from investments that give 100 per cent exposure to the stock market, that they could have payments manipulated to their disadvantage and many gain little if any benefit from with-profits guarantees. In a worst-case example investors could share in losses on other business. While some of these disadvantages could be overcome by reform, others cannot be removed.  It is all very confusing for investors. Are with-profits policies still worth buying? Some advisers think so, and are particularly keen on with-profits bonds.  Patrick Connolly of Chartwell Investment Management says  'We have always said it is essential to invest with the biggest and strongest companies, and to buy a bond with a view to staying in for at least five years.  'If you do that then the market value adjuster is not really a concern as such companies are unlikely to apply an MVA except in the early years.'  Clive Scott-Hopkins of Towry Law is also positive. 'With-profits policies are holding up extremely well compared with direct equity investments. We think there is still a place for them.'  However, he expects to see terminal bonus rates coming down next year, possibly sharply, and suggests anyone with an endowment or pension policy due to mature next year may do better to cash in or take benefits early. This is one time when you may be able to take advantage of the smoothing mechanism and get paid more than your asset share.  Other advisers are less positive on with-profits. Tom McPhail of Torquil Clark says  'I am not a big fan of with-profits in its present form. There is a market for a smoothed managed fund immediately pre-retirement and post retirement. But I would prefer to see investors constructing portfolios with perhaps a similar mix of investments but matched to their particular needs.'",
                "It has long been observed that investors have a habit of buying the asset class that performed strongest in the preceding year. Largely for this reason, corporate bond funds are tipped to be among the bright spots of a dull 2002 Isa season.  But is this a logical response to the recent underperformance of equities, or a case of investors jumping on the bandwagon just as the wheels come off?  The average UK Corporate Bond fund appreciated in value by 5.2 per cent in the year to February 1, with income re-invested.  With falling interest rates the friend of the corporate bond, this was unsurprising. In the same period the average UK All Companies equity fund lost 16.2 per cent of its value.  Industry figures show that 19 per cent of the Pounds 28.7bn private investors poured into unit trusts in 2001 went into bond funds, up from 12 per cent in 2000.  And much of the advertising commissioned by investment houses this year is being used to drum up support for bond funds still further.  Admittedly, the sector is perhaps the most tax-efficient use of one's Isa wrapper, with all income arriving free of tax.  But there are pitfalls, as Jason Hollands of London-based IFA Bestinvest notes  'Are investors doing the same thing as so many times before and buying at the wrong time?'  The question of timing is ultimately dependant on the type of bonds held by a particular fund. In essence, they fall into two categories.  Investment grade bonds are issued by companies with strong credit ratings, those that the market believes are unlikely to default. They range from the most secure AAA-rated, currently yielding around 5.5 per cent (half a percentage point more than UK government gilts), to BBB, paying around 6.5 per cent.  John Hatherly, head of global analysis at M&G, says the capital value of these bonds is 80 per cent dependant on expectations of future interest rates, with the performance of the issuing company a minor factor.  The low-risk Norwich Union Corporate Bond fund holds debt from companies such as Scottish Power, Anglian Water and Bank of Scotland, for instance. It has returned 4.4 per cent over the past 12 months.  As UK base rates have tumbled from 6 per cent in February 2001 to 4 per cent today, the option of receiving a coupon of 8.75 per cent from Scottish Power becomes more attractive, and the capital value of the bond appreciates.  Needless to say, if interest rates begin their journey back upwards in the next 12 months, as most commentators predict, these investment-grade bonds, and the funds that hold them, could suffer.  Ben Yearsley of IFA Hargreaves Lansdown says  'It's likely that capital values will fall if rates rise, and they clearly will do.'  The second category is sub-investment grade or 'junk' bonds, issued by companies judged more likely to default.  Because of the higher risk, these companies have to pay higher interest rates to offer an acceptable risk-return trade-off. For example, the Invesco Perpetual European High Yield fund holds debt issued by Dutch telecoms company KPNQwest and telecoms equipment maker Lucent Technologies.  Indeed, the high-yield bond sector is dominated by tech and telecoms companies, with debt issued by troubled cable operator NTL currently yielding 35 per cent, and that of Marconi returning 24.7 per cent. The capital value of these bonds is influenced more strongly by perceptions of whether the issuer is likely to default than interest rate expectations.  In an economic downturn, market values are likely to fall. The NTL bond has lost two-thirds of its capital value since launch. The  Invesco High Yield fund is down 20.9 per cent in a year. But if the economy starts to pick up from here, as many suspect, the risk of default will fall, and bond prices will rise. Paul Causer, joint manager of the Invesco fund, is confident, despite the continuing flow of high-profile defaulters, which have taken the default rate to 13.5 per cent in the US.  'We've had Global Crossing, the biggest ever telecoms company default, before that Enron, and for sure we are going to get a restructuring at NTL,' he says. 'But the damage has already been done, the market has already priced in a lot of the bad news.  'We are in a period very similar to the early 1990s. In 1991 the default rate peaked at over 10 per cent, but we had our best ever year with returns in high yield in the high 30 per cent and low 40 per cents. In 1991, 1992 and 1993 we had double digit returns and outpaced to S&P 500.'  The yield on the fund is currently a little over 10.5 per cent, but other, even riskier, funds are yielding as much as 16 per cent.  Mr Hollands of Bestinvest is recommending the Invesco fund as his high-risk income option for 2002. 'I think that high-yield bonds look very attractive. There is a huge premium, the sector has been pretty burnt out and over sold,' he says.  He also likes the Invesco Perpetual Monthly Income Plus fund as a lower risk option. This is a hybrid fund, with 17 per cent of its assets in high-yield UK equities, 57 per cent in high-yield bonds, and the remainder in investment grade bonds.  Yearsley of Hargreaves favours the Royal & SunAlliance Maximum Income Bond fund, with bonds from United Biscuits to Energis, as a high-risk option.  For lower risk investors he suggests Norwich Union Higher Income Plus, another blend of investment grade and higher risk bonds, with a particular preponderance for bank debt, or M&G Corporate Bond, which simply tries to beat the return from gilts.",
                "In recent weeks, several high-profile FTSE companies have taken a scythe to their dividends.  ICI, Reuters and Royal & Sun Alliance cut theirs by up to a half. Schroders, Old Mutual and Reckitt Benckiser have frozen their distributions. And CGNU signalled it would cut this year's pay-out by nearly 40 per cent.  Many investors are now unsure whether companies are entering a period of widespread cuts or whether the headlines are just focusing on the bad news.  Certainly, dividend growth has been slowing for many years. But there is little agreement about how the future will pan out.  Equity strategists disagree, for example, about how many companies will find it difficult to maintain dividend growth this year.  The confident insist no more than 10 FTSE 100 companies will cut pay-outs. At the more pessimistic end of the spectrum, Khuram Chaudhry, at Merrill Lynch, believes up to 50 of the top 100 could cut dividends.  Schroder Salomon Smith Barney says the consensus among strategists is for average dividend growth across the FTSE of 6 per cent.  The market, as ever, is split between the stalwart income-payers such as the banks and the rest that chop and change pay-outs according to cyclical circumstances.  'Industrials are the ones at risk,' says Gareth Williams at ABN Amro. 'They account for more than half of all dividends, but face pressure on their capacity to pay.'  Analysts say those with large debt burdens and high gearing - such as MMO, Allied Domecq, Invensys, Unilever and Daily Mail & General Trust - are particularly exposed.  Final salary pension schemes, especially those that exceed the market capitalisation of the companies behind them, are also posing problems.  Merrill cites British Airways, Coats, Marconi, Corus, Invensys, ICI, British Energy, GKN, Pilkington, National Power, Rexam and BT Group as having pension schemes fitting in this category.  Under the new FRS 17 accounting standard, which takes an annual snapshot of pension scheme assets and liabilities, companies must put theoretical funding deficits through their balance sheets. In the worst cases, dividends will have to be cut unless companies have reserves to subsidise them.  Many companies also have constrained cash flow. 'The dividends of non-financials are uncovered at the free cash level with a ratio of only 0.7,' says Mr Williams.  In dividend cover terms, water companies, IT hardware companies and electronics are all running insufficient earnings to cover their pay-outs.  The market as a whole also has lower cover ratios than it once had. Compared to a traditional norm of earnings per share of about two times dividend pay-outs, the average for the FTSE 100 companies is now about 1.66 and for the FTSE Small Cap about 0.99.  So far, insurers have dominated the cuts for 2001. RSA cut its dividend to conserve capital needed to underwrite new business. CGNU and Britannic have also said or hinted they will do the same this year.  Nevertheless, the consensus suggests that even drastic cuts in some sectors will be offset elsewhere to produce dividend growth, on average, up from 3.8 per cent last year to 6 per cent.  Banks will be the mainstay - they are well capitalised and profitability and cash generation are still high. HSBC even raised its dividend by 10 per cent this week despite a 22 per cent decline in earnings.  But Ian Scott at Lehman Brothers says expectations of improving earnings growth across the economy are fuelling confidence.  'For the bulk of companies, the worst should be behind us. That is the main justification for dividend growth forecasts,' he says.  Although SSSB's consensus estimate for 2002 earnings growth at FTSE 100 companies is only 3.5 per cent compared with the 6 per cent dividend growth prediction, the funding gap is only expected to last a year. The consensus estimate for 2003 earnings growth is 13.6 per cent compared with dividend growth of 7.2 per cent.  Not everyone is as confident. Mr Williams predicts average dividend growth of 4 per cent this year, below the consensus. Alex Stewart at Dresdner Kleinwort Wasserstein goes further, predicting a 2002 dividend growth average scaled back to 2 or 3 per cent.  Investors question the need for some of the dividend cuts. Jeremy Tighe at Foreign & Colonial Investment Trust says there has been an 'insidious' fashion for some companies to 'rebase' their dividends.  One of the most prominent companies to rebase its pay-out was Reuters, which cuts its distribution from 16p to 10p and pledged to pursue 'a progressive dividend policy' from that new base.  Mr Tighe says there are risks with such a strategy as dividends have propped up share prices. 'Reuters tell us it will grow, but the returns will be mostly as capital. That is lower quality and less secure than paying out income returns and signals increasing risk.' Additional reporting by Kate Burgess and Pauline Skypala"
        };
        String sentence = sentences[_rand.nextInt(sentences.length)];
        _collector.emit(new Values(sentence, "1"));
    }

    @Override
    public void declareOutputFields(OutputFieldsDeclarer declarer) {
        declarer.declare(new Fields("word", "label"));
    }

}
